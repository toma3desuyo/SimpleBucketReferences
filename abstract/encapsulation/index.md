---
title: カプセル化
description: データと実装を外部から隠蔽し制御する設計原則
---

## 概要
カプセル化は、オブジェクトの内部状態や実装を外部から隠し、公開 API を通じてのみ操作させる原則である。変更に強い構造を作り、誤用を防ぐ。

## 要素
- **可視性修飾子**: public/private/protected などでアクセスを制限する。
- **ゲッター/セッター**: 内部表現を守りつつ必要な情報を提供する。
- **不変条件**: クラスの状態が常に満たすべき条件を定義し、メソッド内で維持する。

## 基本例
```pseudo
クラス 口座:
    private 残高

    メソッド 入金(額):
        もし 額 <= 0 なら 例外
        残高 += 額

    メソッド 残高取得():
        return 残高
```
- 直接 `残高` を書き換えられないよう隠蔽し、正当な操作のみ提供する。

## 応用パターン
### 内部表現の差し替え
```pseudo
クラス 設定:
    private ストレージ
    メソッド データ取得(キー): ...
```
- 外部 API を変えずに内部ストレージをファイルからデータベースへ変更できる。

### 不変オブジェクト
```pseudo
クラス 座標:
    コンストラクター(x, y)
    プロパティ X = x (読み取り専用)
```
- 作成後に値を変更できない設計で、共有しても安全。

## 注意点
1. **過度なゲッター**: 全フィールドを公開するようなゲッター/セッターはカプセル化を形骸化させる。必要な操作だけ公開する。
2. **テスト容易性**: 非公開メンバーに依存しないテスト設計を行う。どうしても必要ならテスト専用フレンド API を検討。
3. **パフォーマンスとのトレードオフ**: 低レベルにアクセス制御を加えると性能が落ちる場合がある。ホットパスではインターフェースを薄く保つ。

## 関連トピック
- `abstract/class/index.md`: クラス構造
- `abstract/property-definition/index.md`: プロパティ設計
- `abstract/inheritance/index.md`: アクセス範囲と継承
