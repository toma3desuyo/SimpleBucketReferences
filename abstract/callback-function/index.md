---
title: コールバック関数
description: イベントや完了通知の際に呼び戻される関数の設計
---

## 概要
コールバック関数は別の処理へ渡しておき、特定のタイミングで呼び戻してもらうための関数である。非同期処理、イベント駆動 UI、プラグイン拡張などで挙動を差し込む仕組みとして利用される。

## 特徴
- **逆方向の依存**: 呼び出し元が実行の主導権を持ち、コールバックは結果や状態を受け取る。
- **署名の合意**: 引数や戻り値の形式を契約として定める。省略可能な引数やエラー引数などを含める場合は文書化する。
- **文脈共有**: 必要であれば `this` 参照やコンテキストオブジェクトを一緒に渡す。

## 例
```pseudo
関数 読み込み(成功時, 失敗時):
    非同期通信(...,
        onSuccess: 無名関数(結果):
            成功時(結果)
        onError: 無名関数(理由):
            失敗時(理由)
    )
```
- 成功コールバックと失敗コールバックを分け、呼び出し側が関心のある処理を書けるようにする。

## 応用パターン
### フックシステム
```pseudo
登録("before-save", 無名関数(データ): 検証する)
登録("after-save", 無名関数(データ): 通知する)
```
- 関連イベントに複数コールバックを差し込み、順序や取消しの仕組みを用意する。

### エラーファースト
```pseudo
処理(入力, 無名関数(エラー, 結果):
    もし エラー なら ログ
    そうでなければ 結果を利用
)
```
- 第一引数にエラーを受け取る慣習を設けることで共通のハンドリングを実現する。

## 注意点
1. **コールバック地獄**: 深いネストは可読性と例外処理を難しくする。フューチャーや async/await へ段階的に置き換える。
2. **多重呼び出し**: 同じコールバックが複数回呼ばれる可能性を考慮し、状態を idempotent に保つ。
3. **例外伝播**: コールバック内部の例外は呼び出し元のスレッドで起きる。必要に応じて try/catch で包み、ログを出す。

## 関連トピック
- `abstract/anonymous-function/index.md`: 無名関数
- `abstract/async-processing/index.md`: 非同期処理
- `abstract/exception-handling/index.md`: 例外の扱い
