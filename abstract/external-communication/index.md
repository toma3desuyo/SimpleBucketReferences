---
title: 外部通信
description: 他システムとデータをやり取りする抽象的な仕組み
---

## 概要
外部通信はプロセスやサービス間でメッセージを交換する行為であり、HTTP、メッセージキュー、ソケットなどの手段がある。信頼性、遅延、セキュリティを考慮して設計する。

## 主な要素
- **プロトコル**: HTTP、gRPC、MQTT などの規格を選び、バージョン管理を行う。
- **シリアライズ形式**: JSON、XML、バイナリなど。互換性とサイズを天秤にかける。
- **接続戦略**: 同期リクエスト/レスポンス、非同期メッセージング、ストリーミングなど利用形態を決める。

## 基本フロー
```pseudo
要求 = { "操作"→"取得", "ID"→123 }
ペイロード = エンコード(JSON, 要求)
レスポンス = HTTP.送信(POST, エンドポイント, ペイロード)
結果 = デコード(JSON, レスポンス.本文)
```
- タイムアウトや再試行ポリシーを設定し、通信失敗時の挙動を定義する。

## 応用パターン
### 冪等キー
```pseudo
要求.ヘッダ["Idempotency-Key"] = UUID()
```
- 同じ操作を再送しても一度だけ処理されるようにする。支払いなど副作用の大きい操作で有効。

### バックオフ再試行
```pseudo
遅延 = 初期待機
while 試行回数 < 上限:
    成功 = 送信()
    もし 成功 なら break
    待機(遅延)
    遅延 = 遅延 * 2
```
- ネットワーク障害に対して指数バックオフで再試行し、システムへの負荷を抑える。

## 注意点
1. **セキュリティ**: 認証・認可を行い、TLS などで暗号化する。入力の検証を徹底する。
2. **バージョニング**: API 変更の際は互換性に注意。契約テストやスキーマ管理を導入する。
3. **可観測性**: リクエスト ID やトレース ID を付与し、監視・ログで追跡できるようにする。

## 関連トピック
- `abstract/async-processing/index.md`: 非同期 I/O
- `abstract/regular-expression/index.md`: プロトコル上のデータ検証
- `abstract/exception-handling/index.md`: 通信失敗時のリカバリ
