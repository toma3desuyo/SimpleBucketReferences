---
title: 要素数の取得
description: コレクションや文字列の要素数を求める操作
---

## 概要
長さの取得は、リストや文字列、バッファなどが含む要素数を求め、境界チェックや進捗表示に利用する。`length`/`size`/`count` などの API で提供される。

## 特徴
- **計算コスト**: 一部の構造は O(1) で得られるが、リンクリストやストリームでは走査が必要になる。
- **単位**: 文字列は文字数かバイト数かを明示する。マルチバイト文字列では差が生じる。
- **同期性**: 可変コレクションでは並行更新中の長さ取得が整合するか仕様を定める。

## 基本例
```pseudo
メッセージ = "こんにちは"
文字数 = メッセージ.長さ()  # 5 か UTF-8 バイト数かは API による
もし 入力.長さ() > 上限 なら バリデーションエラー
```
- 長さをチェックして境界を守る。

## 応用パターン
### キャッシュ
```pseudo
クラス バッファ:
    private データ
    private 長さキャッシュ

    メソッド 長さ():
        もし 長さキャッシュ が null なら:
            長さキャッシュ = データ.計算長()
        return 長さキャッシュ
```
- 計算コストが高い場合はキャッシュを保持する。ただし変更時に無効化する。

### ストリーム長
```pseudo
while ストリーム.読み込み可能():
    長さ += 1
```
- 事前に長さが分からない場合は逐次的にカウントしてメタ情報を作る。

## 注意点
1. **単位のずれ**: 文字数とバイト数を混同しない。API 名に単位を含めると誤解が減る。
2. **大きな値**: 長さが 32bit を超える場合、戻り値型を十分に大きくする。
3. **リアルタイム更新**: 長さを取得した直後にコレクションが変わることを想定し、防御的に境界チェックを繰り返す。

## 関連トピック
- `abstract/list/index.md`: リスト構造
- `abstract/string-type/index.md`: 文字列の長さ
- `abstract/value-enumeration/index.md`: 要素数と列挙
