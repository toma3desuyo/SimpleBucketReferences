---
title: 連想配列の要素削除
description: キーを指定してエントリを取り除き整合性を保つ方法
---

## 概要
連想配列の要素削除は、特定キーに結び付いた値を取り除き、必要に応じてリソースや派生データを更新する操作である。削除の結果を呼び出し側へ伝え、残存するエントリの順序や参照に影響が出ないよう管理する。

## 削除戦略
- **即時削除**: `削除(キー)` を呼ぶと即座にエントリが消える。高速だが同時走査との整合が課題。
- **遅延削除**: 削除フラグを立てて後でクリーンアップする。反復中でも安全だがメモリを食う。
- **一括削除**: 条件を満たす複数キーをまとめて削除し、通知や再計算を 1 回にまとめる。

## 例
```pseudo
関数 エントリ削除(マップ, キー):
    もし マップ.存在(キー) でないなら:
        return 偽
    副作用を処理(キー, マップ.取得(キー))
    マップ.削除(キー)
    return 真
```
- 存在しない場合は静かに失敗するか例外を送出するか仕様で決める。
- 副作用（キャッシュ更新、監査ログ、参照解除）を削除前に処理する。

## 応用パターン
### 条件付き掃除
```pseudo
期限切れ一覧 = フィルタ(マップ.ペア列挙(), 条件: 現在時刻 > 値.期限)
for (キー, _) in 期限切れ一覧:
    マップ.削除(キー)
```
- 期限やサイズ上限などのポリシーに基づき削除する。削除前後で監査イベントを発行する。

### トランザクション
```pseudo
トランザクション開始()
削除成功 = マップ.削除(キー)
もし 削除成功 なら 関連インデックス.更新(キー)
トランザクション確定()
```
- 複数構造を同期させる場合はトランザクション境界を定義し、途中失敗時にロールバックする。

## 注意点
1. **走査との競合**: 列挙中に削除するとイテレータが無効化される実装がある。専用の安全な削除 API を用いるか、列挙対象を複製する。
2. **参照のぶら下がり**: 他の構造が削除済みキーを指している場合は、一緒に無効化する仕組みを持つ。
3. **弱参照マップ**: GC に任せる構造では積極的に削除しなくてもよいが、予測不能なタイミングになる点を利用者に周知する。

## 関連トピック
- `abstract/associative-array/index.md`: 連想配列の基本
- `abstract/key-existence/index.md`: 削除前の存在確認
- `abstract/value-enumeration/index.md`: 削除対象の選定
