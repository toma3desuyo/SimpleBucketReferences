---
title: インスタンスの生成
description: クラス定義から実体を作り出すプロセス
---

## 概要
インスタンス生成はクラスやプロトタイプから具体的なオブジェクトを構築し、フィールドを初期化する処理である。コンストラクターやファクトリーメソッドを通じて行われる。

## ステップ
1. メモリ確保: 新しいオブジェクト領域を割り当てる。
2. 既定値の設定: 各フィールドに初期値を設定する。
3. コンストラクター実行: 渡された引数を用いて状態を整える。
4. 参照の返却: 生成されたインスタンスを呼び出し元へ返す。

## 基本例
```pseudo
利用者 = 新しい ユーザー(id: 1, 名前: "藍")
```
- `新しい` キーワードや `User()` のような呼び出しで生成する。

## 応用パターン
### ファクトリーメソッド
```pseudo
クラス ユーザー:
    静的メソッド ゲスト():
        return 新しい ユーザー(id: 0, 名前: "guest")
```
- 複雑な初期化や条件分岐をクラスメソッドにまとめる。

### プロトタイプからの複製
```pseudo
雛形 = { 権限: ["閲覧"], 有効: 真 }
利用者 = コピー(雛形)
利用者.名前 = "藍"
```
- 既存のオブジェクトを複製して変更する。ディープコピーの必要性を判断する。

## 注意点
1. **重いコンストラクター**: I/O や重計算を含むと生成コストが高い。遅延初期化へ分割する。
2. **例外発生時のクリーンアップ**: 途中で失敗した場合のリソース解放を設計する。
3. **プールとの相性**: 頻繁に生成・破棄するオブジェクトはプールして再利用すると効率的だが、初期状態へ戻す処理を忘れない。

## 関連トピック
- `abstract/instance-initialization/index.md`: 初期化の詳細
- `abstract/class/index.md`: クラス定義
- `abstract/static-members/index.md`: ファクトリーメソッド
