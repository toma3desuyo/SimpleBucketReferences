---
title: キーの存在確認
description: 連想配列でキーが登録済みか調べる操作
---

## 概要
キー存在確認は、連想配列やマップ内に特定キーが登録されているかどうかを真偽値で返す。値が null でも存在する場合と区別したいときに用いる。

## API デザイン
- **戻り値**: 真偽値だけ返すか、存在時に値も返すかを選択する。`(存在, 値)` 形式も有用。
- **計算コスト**: ハッシュマップなら平均 O(1)、ツリーマップなら O(log n)。
- **サイドエフェクト**: 確認時に値を読み出すだけか、利用回数を記録するかなど仕様化する。

## 基本例
```pseudo
もし 設定.存在("timeout") なら:
    値 = 設定.取得("timeout")
    適用(値)
そうでなければ:
    設定.代入("timeout", 30)
```
- 値が `null` であっても「存在する」と扱えるため、`取得` の結果と区別できる。

## 応用パターン
### 取得と同時に確認
```pseudo
(存在, 値) = 設定.取得または存在("feature")
もし 存在 なら 使用する
```
- 2度のハッシュ計算を避け、性能を改善できる。

### ダブルチェック
```pseudo
もし キャッシュ.存在(キー) なら:
    return キャッシュ.取得(キー)
ロック取得
もし キャッシュ.存在(キー) なら:
    return キャッシュ.取得(キー)
```
- マルチスレッド環境での初期化競合を防ぐために再度確認する。

## 注意点
1. **遅延読み込み**: 存在確認だけでディスクアクセスが走ると遅い。メタデータを保持するなど最適化する。
2. **競合状態**: 存在確認と後続の操作の間にキーが削除される可能性がある。操作をアトミックにするかバージョン番号を使う。
3. **セキュリティ**: 存在の有無が情報漏えいにつながる場合は同じレスポンスを返すなど工夫する。

## 関連トピック
- `abstract/associative-array/index.md`: 連想配列
- `abstract/associative-array-deletion/index.md`: 削除前の確認
- `abstract/key-enumeration/index.md`: 一括確認
